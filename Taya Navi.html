<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Taya Navi&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">      </span>--bg:#0b0c10; --card:#111319; --card2:#0f1117; --text:#e9ecf1; --muted:#a8b0bd;</p>
<p class="p1"><span class="Apple-converted-space">      </span>--line:#222635; --accent:#7aa2ff; --good:#7ef0c1; --warn:#ffcc66; --bad:#ff6b6b;</p>
<p class="p1"><span class="Apple-converted-space">      </span>--shadow:0 10px 30px rgba(0,0,0,.35); --r:16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (prefers-color-scheme: light){</p>
<p class="p1"><span class="Apple-converted-space">      </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">        </span>--bg:#f6f7fb; --card:#fff; --card2:#fbfbfe; --text:#111827; --muted:#5b6472;</p>
<p class="p1"><span class="Apple-converted-space">        </span>--line:#e5e7ef; --accent:#2f5eff; --good:#0ea5e9; --warn:#b45309; --bad:#dc2626;</p>
<p class="p1"><span class="Apple-converted-space">        </span>--shadow:0 12px 26px rgba(17,24,39,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">    </span>body{</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin:0; padding:28px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background:var(--bg); color:var(--text); line-height:1.45;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.wrap{max-width:1120px;margin:0 auto}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.top{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:16px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>h1{margin:0 0 6px 0;font-size:20px;letter-spacing:.2px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.sub{margin:0;color:var(--muted);font-size:12.5px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.grid{display:grid;grid-template-columns:1.25fr .75fr;gap:16px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media(max-width:980px){.grid{grid-template-columns:1fr}}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:16px;box-shadow:var(--shadow)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card h2{margin:0 0 10px 0;font-size:14px;display:flex;justify-content:space-between;align-items:center;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>label{display:block;margin:0 0 6px 0}</p>
<p class="p1"><span class="Apple-converted-space">    </span>textarea,input,select{</p>
<p class="p1"><span class="Apple-converted-space">      </span>width:100%; background:transparent; color:var(--text);</p>
<p class="p1"><span class="Apple-converted-space">      </span>border:1px solid var(--line); border-radius:12px; padding:10px 12px; outline:none; font-size:13px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>textarea{min-height:210px;resize:vertical}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hint{color:var(--muted);font-size:12px;margin-top:6px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.row{display:grid;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media(max-width:540px){.two{grid-template-columns:1fr}}</p>
<p class="p1"><span class="Apple-converted-space">    </span>details{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--card2)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>summary{cursor:pointer;font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button{</p>
<p class="p1"><span class="Apple-converted-space">      </span>border:1px solid var(--line);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));</p>
<p class="p1"><span class="Apple-converted-space">      </span>color:var(--text); border-radius:12px; padding:10px 12px; cursor:pointer; font-size:13px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button.primary{border-color:rgba(122,162,255,.35);background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.10))}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button.ghost{background:transparent}</p>
<p class="p1"><span class="Apple-converted-space">    </span>button:active{transform:translateY(1px)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.status{margin-top:10px;font-size:12px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);background:var(--card2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.good{color:var(--good);font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.warn{color:var(--warn);font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.bad{color:var(--bad);font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.out{min-height:190px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="top"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h1&gt;Taya Navi &lt;span class="mono"&gt;v2.1&lt;/span&gt;&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p class="sub"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Paste company names → choose mode → generate a &lt;span class="good"&gt;shared URL (no sessionId)&lt;/span&gt; for Sales Navigator. &lt;br/&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;b&gt;Former only&lt;/b&gt; automatically adds &lt;span class="mono"&gt;CURRENT_COMPANY=EXCLUDED&lt;/span&gt; to exclude people currently at those companies.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span&gt;Input&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;span class="pill"&gt;&lt;span class="good"&gt;Stable&lt;/span&gt; double-encode + length guard + split&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/h2&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;&lt;b&gt;Company names&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;textarea id="companies" placeholder="Examples (any delimiter works):</p>
<p class="p1">Takasago / T. Hasegawa, IFF; ADM</p>
<p class="p1">高砂香料工業、長谷川香料</p>
<p class="p1">Milliken (Westex)・Glen Raven"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Auto-splits by: comma &lt;span class="mono"&gt;,&lt;/span&gt; / Chinese comma &lt;span class="mono"&gt;，&lt;/span&gt; / Japanese &lt;span class="mono"&gt;、&lt;/span&gt; / colon &lt;span class="mono"&gt;:&lt;/span&gt; &lt;span class="mono"&gt;：&lt;/span&gt; / middle dot &lt;span class="mono"&gt;・&lt;/span&gt; / slash &lt;span class="mono"&gt;/&lt;/span&gt; &lt;span class="mono"&gt;\&lt;/span&gt; / semicolon &lt;span class="mono"&gt;;&lt;/span&gt; &lt;span class="mono"&gt;；&lt;/span&gt; / newline.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="height:12px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="two"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;&lt;b&gt;Mode&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;select id="mode"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="PAST"&gt;Former only (PAST included + CURRENT excluded)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="CURRENT"&gt;Current only&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="BOTH"&gt;Both (CURRENT + PAST)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;&lt;b&gt;Auto expansion (dictionary)&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;select id="dictMode"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="ON" selected&gt;ON (recommended)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;option value="OFF"&gt;OFF (input only)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="height:10px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;details&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;summary&gt;&lt;b&gt;Advanced&lt;/b&gt; (industry templates, dictionary JSON, splitting)&lt;/summary&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div style="height:10px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="two"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;&lt;b&gt;Industry template&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;select id="dictTemplate"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="generic" selected&gt;Generic (minimal)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="ff"&gt;Fragrance &amp; Flavor&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="dc"&gt;Data Center&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="chem"&gt;Chemicals&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="energy"&gt;Energy&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="hint"&gt;Selecting a template overwrites the dictionary JSON below.&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label&gt;&lt;b&gt;Auto split URL&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;select id="splitMode"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="AUTO" selected&gt;AUTO (split only when too long)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="OFF"&gt;OFF (never split)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;option value="ALWAYS"&gt;ALWAYS (always split)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="hint"&gt;Both-mode can get long quickly; AUTO is recommended.&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div style="height:10px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;&lt;b&gt;Max companies per URL (when splitting)&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="chunkSize" value="22" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="hint"&gt;Double-encoding increases length; default is conservative.&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div style="height:10px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;b&gt;Dictionary (JSON)&lt;/b&gt; — input → aliases to add automatically&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;textarea id="dictJson" class="out" style="min-height:190px;"&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>Format: {"Company A":["Alias 1","Alias 2"]}. Edit here to extend offline auto-complete.</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/details&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="btns"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="primary" id="buildBtn"&gt;Generate URL&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="copyTeamBtn"&gt;Copy shared URL&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="openTeamBtn" class="ghost"&gt;Open shared URL&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="status" class="status"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h2&gt;&lt;span&gt;Output&lt;/span&gt;&lt;span class="pill"&gt;Shared URL only&lt;/span&gt;&lt;/h2&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;&lt;b&gt;Shared URL (no sessionId)&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;textarea id="output" class="out" readonly&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>If AUTO split triggers, multiple URLs will be listed. Open them one by one.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div style="height:12px;"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;label&gt;&lt;b&gt;Expanded keywords (what actually gets sent)&lt;/b&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;textarea id="expanded" class="out" readonly&gt;&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>If expansions create noise, switch dictionary OFF or remove entries from the JSON.</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;p class="sub" style="margin-top:14px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>If updates don’t show up, add &lt;span class="mono"&gt;?v=123&lt;/span&gt; to the URL to bypass cache.</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/p&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= Encoding =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Company text: encodeURIComponent + explicit ( ) , encoding + double-encode (% -&gt; %25)</p>
<p class="p1"><span class="Apple-converted-space">  </span>function encTextForCompany(name) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const once = encodeURIComponent(name)</p>
<p class="p1"><span class="Apple-converted-space">      </span>.replace(/\(/g, "%28")</p>
<p class="p1"><span class="Apple-converted-space">      </span>.replace(/\)/g, "%29")</p>
<p class="p1"><span class="Apple-converted-space">      </span>.replace(/,/g, "%2C");</p>
<p class="p1"><span class="Apple-converted-space">    </span>return once.replace(/%/g, "%25");</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= Global legal suffix removal =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>// JP: 株式会社 有限会社 合同会社 合資会社 合名会社 （株） （有） ㈱ ㈲</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Global: Co., Ltd / Ltd / Limited / Inc / Corporation / LLC / PLC / AG / GmbH / S.A. / S.p.A. / B.V. / N.V. / Pty Ltd / K.K.</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Only remove if at the end (or surrounded by spaces/punctuation).</p>
<p class="p1"><span class="Apple-converted-space">  </span>const JP_SUFFIXES = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>"株式会社","有限会社","合同会社","合資会社","合名会社",</p>
<p class="p1"><span class="Apple-converted-space">    </span>"（株）","（有）","(株)","(有)","㈱","㈲"</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const EN_SUFFIX_PATTERNS = [</p>
<p class="p1"><span class="Apple-converted-space">    </span>/,\s*co\.\s*ltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bco\.\s*ltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bco,\s*ltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bco\s*ltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\blimited$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\binc\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bincorporated$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bcorp\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bcorporation$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bllc\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bl\.l\.c\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bplc\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bag$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bgmbh$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bs\.a\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bs\.p\.a\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bb\.v\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bn\.v\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bpty\.?\s*ltd\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bk\.k\.?$/i,</p>
<p class="p1"><span class="Apple-converted-space">    </span>/\bkk$/i</p>
<p class="p1"><span class="Apple-converted-space">  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Optional: remove trailing "Holdings" / "Group" (ONLY when it is the last token)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const EN_TRAILING_WORDS = [/[\s,.-]+holdings$/i, /[\s,.-]+group$/i];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function stripLegalSuffixes(name) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>let s = (name || "").trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!s) return s;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// JP exact suffix tokens (end-only)</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const suf of JP_SUFFIXES) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (s.endsWith(suf)) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>s = s.slice(0, s.length - suf.length).trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Remove extra punctuation at the end before EN checks</p>
<p class="p1"><span class="Apple-converted-space">    </span>s = s.replace(/[，、。．\.\s]+$/g, "").trim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// EN patterns</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const re of EN_SUFFIX_PATTERNS) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>s = s.replace(new RegExp(re.source, re.flags), "").trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>s = s.replace(/[,\.\s]+$/g, "").trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Trailing "Holdings"/"Group" (careful)</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const re of EN_TRAILING_WORDS) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>s = s.replace(re, "").trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>s = s.replace(/[,\.\s]+$/g, "").trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>return s.trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= Parsing: multi-delimiter split =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Split by: newline, comma, Chinese comma, Japanese comma, colon variants, middle dot, slash/backslash, semicolon variants</p>
<p class="p1"><span class="Apple-converted-space">  </span>const SPLIT_RE = /[\r\n,，、:：・\/\\;；]+/g;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function parseCompanies(text) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return (text || "")</p>
<p class="p1"><span class="Apple-converted-space">      </span>.split(SPLIT_RE)</p>
<p class="p1"><span class="Apple-converted-space">      </span>.map(x =&gt; x.trim())</p>
<p class="p1"><span class="Apple-converted-space">      </span>.filter(Boolean);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function uniq(arr) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const seen = new Set();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const out = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const x of arr) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const t = (x || "").trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!t) continue;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const key = t.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (seen.has(key)) continue;</p>
<p class="p1"><span class="Apple-converted-space">      </span>seen.add(key);</p>
<p class="p1"><span class="Apple-converted-space">      </span>out.push(t);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>return out;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function safeInt(v, fallback) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const n = parseInt(String(v || "").trim(), 10);</p>
<p class="p1"><span class="Apple-converted-space">    </span>return Number.isFinite(n) &amp;&amp; n &gt; 0 ? n : fallback;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function chunkArray(arr, chunkSize) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const out = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let i = 0; i &lt; arr.length; i += chunkSize) out.push(arr.slice(i, i + chunkSize));</p>
<p class="p1"><span class="Apple-converted-space">    </span>return out;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= Industry templates (dictionary) =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>// You can expand these over time; they’re offline mappings.</p>
<p class="p1"><span class="Apple-converted-space">  </span>const DICT_TEMPLATES = {</p>
<p class="p1"><span class="Apple-converted-space">    </span>generic: {</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Archer-Daniels-Midland": ["ADM"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"International Flavors &amp; Fragrances": ["IFF"]</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>ff: {</p>
<p class="p1"><span class="Apple-converted-space">      </span>"高砂香料工業": ["TAKASAGO INTERNATIONAL CORPORATION", "TAKASAGO INTERNATIONAL"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"長谷川香料": ["T. HASEGAWA CO., LTD.", "T. HASEGAWA"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"小川香料": ["Ogawa &amp; Co., Ltd.", "Ogawa &amp;"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"塩野香料": ["SHIONO KORYO KAISHA, LTD", "SHIONO KORYO KAISHA"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Archer-Daniels-Midland": ["ADM"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"International Flavors &amp; Fragrances": ["IFF"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"DSM Firmenich": ["Firmenich", "DSM-Firmenich"]</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>dc: {</p>
<p class="p1"><span class="Apple-converted-space">      </span>"NTTコミュニケーションズ": ["NTT Communications", "NTT Com", "NTT Communications Corporation"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"さくらインターネット": ["Sakura Internet", "SAKURA internet"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"KDDI": ["KDDI Corporation"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"ソフトバンク": ["SoftBank", "SoftBank Corp."],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"エクイニクス": ["Equinix"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"AirTrunk": ["Air Trunk"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"富士通": ["Fujitsu", "Fujitsu Limited"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"NEC": ["NEC Corporation"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"TIS": ["TIS Inc.", "TIS"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"日立製作所": ["Hitachi", "Hitachi, Ltd."]</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>chem: {</p>
<p class="p1"><span class="Apple-converted-space">      </span>"BASF": ["BASF SE"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Dow": ["Dow Inc.", "The Dow Chemical Company"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Evonik": ["Evonik Industries"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"三菱ケミカル": ["Mitsubishi Chemical", "Mitsubishi Chemical Group"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"住友化学": ["Sumitomo Chemical"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"旭化成": ["Asahi Kasei"]</p>
<p class="p1"><span class="Apple-converted-space">    </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>energy: {</p>
<p class="p1"><span class="Apple-converted-space">      </span>"NextEra": ["NextEra Energy"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"NRG": ["NRG Energy"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Talen": ["Talen Energy"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"AEP": ["American Electric Power"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"Constellation": ["Constellation Energy"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"PJM": ["PJM Interconnection"],</p>
<p class="p1"><span class="Apple-converted-space">      </span>"FERC": ["Federal Energy Regulatory Commission"]</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function getDictFromTextarea() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const raw = document.getElementById("dictJson").value.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!raw) return {};</p>
<p class="p1"><span class="Apple-converted-space">    </span>try {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const obj = JSON.parse(raw);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!obj || typeof obj !== "object") return {};</p>
<p class="p1"><span class="Apple-converted-space">      </span>return obj;</p>
<p class="p1"><span class="Apple-converted-space">    </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return null; // invalid JSON</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function expandNames(inputNames, dictOn, dictObj) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>let out = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const raw of inputNames) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const n = raw.trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!n) continue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Original</p>
<p class="p1"><span class="Apple-converted-space">      </span>out.push(n);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Legal suffix stripped (JP + global)</p>
<p class="p1"><span class="Apple-converted-space">      </span>const stripped = stripLegalSuffixes(n);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (stripped &amp;&amp; stripped !== n) out.push(stripped);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Also attempt removing only 株式会社 quickly (legacy compatibility)</p>
<p class="p1"><span class="Apple-converted-space">      </span>const jpQuick = n.replace(/株式会社/g, "").trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (jpQuick &amp;&amp; jpQuick !== n) out.push(jpQuick);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Dictionary expansions</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (dictOn &amp;&amp; dictObj) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const adds = []</p>
<p class="p1"><span class="Apple-converted-space">          </span>.concat(dictObj[n] || [])</p>
<p class="p1"><span class="Apple-converted-space">          </span>.concat(dictObj[stripped] || [])</p>
<p class="p1"><span class="Apple-converted-space">          </span>.concat(dictObj[jpQuick] || []);</p>
<p class="p1"><span class="Apple-converted-space">        </span>out.push(...adds);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Second pass: strip suffixes on added items too</p>
<p class="p1"><span class="Apple-converted-space">    </span>const second = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const x of out) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>second.push(x);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const s2 = stripLegalSuffixes(x);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (s2 &amp;&amp; s2 !== x) second.push(s2);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>return uniq(second);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= Build query =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>function buildValuesEncoded(names, selectionType) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return names</p>
<p class="p1"><span class="Apple-converted-space">      </span>.map(n =&gt; `(text%3A${encTextForCompany(n)}%2CselectionType%3A${selectionType})`)</p>
<p class="p1"><span class="Apple-converted-space">      </span>.join("%2C");</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function buildQueryEncoded(mode, names) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const valuesIncluded = buildValuesEncoded(names, "INCLUDED");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const valuesExcluded = buildValuesEncoded(names, "EXCLUDED");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === "PAST") {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// former only: PAST included + CURRENT excluded</p>
<p class="p1"><span class="Apple-converted-space">      </span>return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +</p>
<p class="p1"><span class="Apple-converted-space">        </span>`(type%3APAST_COMPANY%2Cvalues%3AList(${valuesIncluded}))%2C` +</p>
<p class="p1"><span class="Apple-converted-space">        </span>`(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesExcluded}))` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`))`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mode === "CURRENT") {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +</p>
<p class="p1"><span class="Apple-converted-space">        </span>`(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesIncluded}))` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`))`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// BOTH: PAST included + CURRENT included</p>
<p class="p1"><span class="Apple-converted-space">    </span>return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`(type%3APAST_COMPANY%2Cvalues%3AList(${valuesIncluded}))%2C` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesIncluded}))` +</p>
<p class="p1"><span class="Apple-converted-space">    </span>`))`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function buildSNUrl({ mode, names }) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const query = buildQueryEncoded(mode, names);</p>
<p class="p1"><span class="Apple-converted-space">    </span>return `https://www.linkedin.com/sales/search/people?query=${query}&amp;viewAllFilters=true`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ========= UI logic =========</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $companies = document.getElementById("companies");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $mode = document.getElementById("mode");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $dictMode = document.getElementById("dictMode");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $dictTemplate = document.getElementById("dictTemplate");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $dictJson = document.getElementById("dictJson");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $splitMode = document.getElementById("splitMode");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $chunkSize = document.getElementById("chunkSize");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $output = document.getElementById("output");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $expanded = document.getElementById("expanded");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const $status = document.getElementById("status");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let lastTeamUrls = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function setStatus(text, level) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cls = level === "good" ? "good" : (level === "warn" ? "warn" : "bad");</p>
<p class="p1"><span class="Apple-converted-space">    </span>$status.innerHTML = `&lt;span class="${cls}"&gt;${text}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function applyTemplate() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const key = $dictTemplate.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const obj = DICT_TEMPLATES[key] || DICT_TEMPLATES.generic;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$dictJson.value = JSON.stringify(obj, null, 2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>async function copyText(text) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>try { await navigator.clipboard.writeText(text); return true; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>catch { return false; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function openUrl(url) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.open(url, "_blank", "noopener,noreferrer");</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function build() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const input = parseCompanies($companies.value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const mode = $mode.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dictOn = ($dictMode.value === "ON");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const dictObj = getDictFromTextarea();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (dictOn &amp;&amp; dictObj === null) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setStatus("Dictionary JSON is invalid. Fix JSON or turn dictionary OFF.", "bad");</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const expanded = expandNames(input, dictOn, dictObj || {});</p>
<p class="p1"><span class="Apple-converted-space">    </span>$expanded.value = expanded.join("\n");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// URL length policy (double encoding =&gt; stricter)</p>
<p class="p1"><span class="Apple-converted-space">    </span>const hardLimit = 7600;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const warnLimit = 6200;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const splitMode = $splitMode.value;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const chunkSize = safeInt($chunkSize.value, 22);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function buildOne(names) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return buildSNUrl({ mode, names });</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// build once first</p>
<p class="p1"><span class="Apple-converted-space">    </span>let urls = [buildOne(expanded)];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const len = urls[0].length;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const mustSplit = (splitMode === "ALWAYS") || (splitMode === "AUTO" &amp;&amp; len &gt; hardLimit);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const shouldWarn = (len &gt; warnLimit);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (mustSplit) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const chunks = chunkArray(expanded, chunkSize);</p>
<p class="p1"><span class="Apple-converted-space">      </span>urls = chunks.map(c =&gt; buildOne(c));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>lastTeamUrls = urls;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// output</p>
<p class="p1"><span class="Apple-converted-space">    </span>const lines = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastTeamUrls.length === 1) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>lines.push("[Shared URL (no sessionId)]");</p>
<p class="p1"><span class="Apple-converted-space">      </span>lines.push(lastTeamUrls[0]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>lines.push(`[Shared URL (no sessionId)] Split into ${lastTeamUrls.length} URLs`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>lastTeamUrls.forEach((u, i) =&gt; lines.push(`(${i+1}) ${u}`));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>$output.value = lines.join("\n");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// status</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastTeamUrls.length &gt; 1) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setStatus(`Done: ${expanded.length} keywords. URL too long → split into ${lastTeamUrls.length}. (Open one by one)`, "good");</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (shouldWarn) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setStatus(`Done: ${expanded.length} keywords. URL length ${len} (long). Consider AUTO split for BOTH mode.`, "warn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>setStatus(`Done: ${expanded.length} keywords. URL length ${len}.`, "good");</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById("buildBtn").addEventListener("click", build);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById("copyTeamBtn").addEventListener("click", async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!lastTeamUrls.length) build();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ok = await copyText(lastTeamUrls.join("\n"));</p>
<p class="p1"><span class="Apple-converted-space">    </span>setStatus(ok ? "Copied shared URL(s)." : "Copy failed. Please copy manually.", ok ? "good" : "bad");</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>document.getElementById("openTeamBtn").addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!lastTeamUrls.length) build();</p>
<p class="p1"><span class="Apple-converted-space">    </span>openUrl(lastTeamUrls[0]);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$dictTemplate.addEventListener("change", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>applyTemplate();</p>
<p class="p1"><span class="Apple-converted-space">    </span>setStatus("Applied industry template. You can edit the JSON further.", "good");</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// init</p>
<p class="p1"><span class="Apple-converted-space">  </span>applyTemplate();</p>
<p class="p1"><span class="Apple-converted-space">  </span>build();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
