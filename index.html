<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Taya Navi</title>

<link rel="icon" type="image/png" href="favicon.png">

<style>

/* ================= THEME ================= */

:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --card2:#f8f9fd;
  --text:#111827;
  --muted:#55617a;
  --border:#d6dbe6;
  --green:#1bb76e;
  --blue:#2f5eff;
  --red:#d64545;
  --shadow:0 10px 30px rgba(17,24,39,.08);
  --radius:16px;
}

.dark{
  --bg:#0f1117;
  --card:#171a23;
  --card2:#10131a;
  --text:#eaeef3;
  --muted:#9aa4b6;
  --border:#2a2f3c;
  --shadow:0 10px 30px rgba(0,0,0,.35);
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:28px;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans","Noto Sans JP",sans-serif;
  transition:.25s ease;
}

.container{max-width:1100px;margin:0 auto}
h1{margin:0;font-size:28px}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

.sub{font-size:12px;color:var(--muted)}
.controls{display:flex;gap:14px;align-items:center}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
  margin-bottom:18px;
}

.grid{
  display:grid;
  grid-template-columns:1.3fr .7fr;
  gap:20px;
}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

textarea, select{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  font-size:13px;
}
textarea{min-height:100px;resize:vertical}

.labelrow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}

.hint{font-size:12px;color:var(--muted)}

button{
  padding:8px 14px;
  border-radius:12px;
  font-size:13px;
  cursor:pointer;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

.btn-generate{background:rgba(27,183,110,.15)}
.btn-open{background:rgba(47,94,255,.15)}
.btn-copy{opacity:.85}
.btn-clear{background:rgba(214,69,69,.15)}

.kwrap{
  background:var(--card2);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
}

.group{margin-bottom:14px;position:relative}
.remove{
  position:absolute;
  right:0;
  top:0;
  font-size:12px;
  cursor:pointer;
  color:var(--muted);
}

.footerurl{
  font-size:11px;
  color:var(--muted);
  margin-top:8px;
  word-break:break-all;
}

.history-item{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}

.history-meta{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

</style>
</head>

<body>
<div class="container">

<div class="topbar">
  <div>
    <h1>Taya Navi v3.8</h1>
    <div class="sub">Sales Navigator URL Builder</div>
  </div>

  <div class="controls">
    <select id="lang">
      <option value="en">English</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="zh">‰∏≠Êñá</option>
      <option value="mn">–ú–æ–Ω–≥–æ–ª</option>
    </select>
    <button onclick="toggleTheme()">üåô / ‚òÄ</button>
  </div>
</div>

<div class="card">
<div class="grid">

<div>
  <div class="labelrow"><b>Company Names</b></div>
  <textarea id="companies"></textarea>
  <div class="hint">comma / „ÄÅ / „Éª / / / newline supported</div>
</div>

<div>
  <div class="labelrow"><b>Mode</b></div>
  <select id="mode">
    <option value="PAST">Former only (exclude current)</option>
    <option value="CURRENT">Current only</option>
    <option value="BOTH">Both</option>
  </select>

  <hr>

  <div class="kwrap">
    <div class="labelrow"><b>Keyword Groups</b></div>
    <div id="keywordContainer"></div>
    <button onclick="addKeywordGroup()">+ Add Keyword Group (AND)</button>
  </div>
</div>

</div>

<div style="margin-top:14px;display:flex;gap:10px;">
  <button class="btn-generate" onclick="generate()">Generate</button>
  <button class="btn-open" onclick="openURL()">Open</button>
  <button class="btn-copy" onclick="copyURL()">Copy</button>
  <button class="btn-clear" onclick="clearAllInputs()">Clear All</button>
</div>

<div class="footerurl" id="urlFooter"></div>
</div>

<div class="card">
  <div class="grid">
    <div>
      <b>Expanded Companies</b>
      <textarea id="expandedCompanies" readonly></textarea>
    </div>
    <div>
      <b>Expanded Keywords</b>
      <textarea id="expandedKeywords" readonly></textarea>
    </div>
  </div>
</div>

<div class="card">
  <b>Recent Searches</b>
  <div id="historyList"></div>
  <button class="btn-clear" onclick="clearHistory()">Clear History</button>
</div>

</div>

<script>

/* ========= CONFIG ========= */

const SPLIT_REGEX=/[\r\n,Ôºå„ÄÅ„ÄÇ:Ôºö„Éª\/\\;Ôºõ]+/g;
const MAX_GROUPS=4;
const LS_HISTORY="tayaHistory_v38";
const LS_THEME="tayaTheme_v38";
const LS_LANG="tayaLang_v38";

let keywordGroups=[];
let generatedURL="";

/* ========= THEME ========= */

function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem(LS_THEME,
    document.body.classList.contains("dark")?"dark":"light"
  );
}
if(localStorage.getItem(LS_THEME)==="dark"){
  document.body.classList.add("dark");
}

/* ========= LANGUAGE ========= */

const i18n={
  en:{clearInputs:"Clear all inputs?",clearHistory:"Clear history?"},
  ja:{clearInputs:"ÂÖ•ÂäõÂÜÖÂÆπ„Çí„Åô„Åπ„Å¶„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü",clearHistory:"Â±•Ê≠¥„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü"},
  zh:{clearInputs:"Á°ÆÂÆöÊ∏ÖÁ©∫ÊâÄÊúâËæìÂÖ•ÂÜÖÂÆπÂêóÔºü",clearHistory:"Á°ÆÂÆöÊ∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü"},
  mn:{clearInputs:"–ë“Ø—Ö –æ—Ä–æ–ª—Ç—ã–≥ —Ü—ç–≤—ç—Ä–ª—ç—Ö “Ø“Ø?",clearHistory:"–ë“Ø—Ö —Ç“Ø“Ø—Ö–∏–π–≥ —É—Å—Ç–≥–∞—Ö —É—É?"}
};

document.getElementById("lang").addEventListener("change",(e)=>{
  localStorage.setItem(LS_LANG,e.target.value);
});
document.getElementById("lang").value=localStorage.getItem(LS_LANG)||"en";

/* ========= GROUPS ========= */

function addKeywordGroup(value=""){
  if(keywordGroups.length>=MAX_GROUPS) return;
  const id="kw"+Date.now();
  keywordGroups.push(id);

  const div=document.createElement("div");
  div.className="group";
  div.innerHTML=`
    <div class="labelrow">
      <b>Group ${keywordGroups.length}</b>
      <span class="remove" onclick="removeGroup('${id}')">Remove</span>
    </div>
    <textarea id="${id}">${value}</textarea>
  `;
  document.getElementById("keywordContainer").appendChild(div);
}

function removeGroup(id){
  keywordGroups=keywordGroups.filter(x=>x!==id);
  document.getElementById(id).parentElement.remove();
}

/* ========= CORE ========= */

function uniq(arr){return [...new Set(arr.map(x=>x.trim()).filter(Boolean))];}

function encDouble(str){
  return encodeURIComponent(str)
    .replace(/\(/g,"%28")
    .replace(/\)/g,"%29")
    .replace(/%/g,"%25");
}

function formatGroup(raw){
  const list=uniq((raw||"").split(SPLIT_REGEX));
  if(!list.length) return "";
  return list.map(k=>`"${k}"`).join(" OR ");
}

function buildFilters(names,mode){
  function values(list,type){
    return list.map(n=>`(text%3A${encDouble(n)}%2CselectionType%3A${type})`).join("%2C");
  }
  if(mode==="PAST"){
    return `(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"EXCLUDED")}))`;
  }
  if(mode==="CURRENT"){
    return `(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
  }
  return `(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
}

function generate(){
  const companies=document.getElementById("companies").value;
  const mode=document.getElementById("mode").value;

  const names=uniq((companies||"").split(SPLIT_REGEX));
  document.getElementById("expandedCompanies").value=names.join("\n");

  const filters=buildFilters(names,mode);

  const groups=keywordGroups
    .map(id=>formatGroup(document.getElementById(id).value))
    .filter(Boolean);

  const keywordString=groups.map(g=>`(${g})`).join(" AND ");
  document.getElementById("expandedKeywords").value=keywordString;

  const keywordBlock=keywordString
    ? `%2Ckeywords%3A${encDouble(keywordString)}`
    : "";

  const query=`(spellCorrectionEnabled%3Atrue%2Cfilters%3AList(${filters})${keywordBlock})`;
  generatedURL=`https://www.linkedin.com/sales/search/people?query=${query}&viewAllFilters=true`;

  document.getElementById("urlFooter").innerText=generatedURL;
  saveHistory();
}

function openURL(){if(generatedURL)window.open(generatedURL,"_blank");}
function copyURL(){if(generatedURL)navigator.clipboard.writeText(generatedURL);}

/* ========= CLEAR ========= */

function clearAllInputs(){
  const lang=localStorage.getItem(LS_LANG)||"en";
  if(!confirm(i18n[lang].clearInputs)) return;

  document.getElementById("companies").value="";
  document.getElementById("mode").value="PAST";
  document.getElementById("keywordContainer").innerHTML="";
  keywordGroups=[];
  addKeywordGroup("");
  document.getElementById("expandedCompanies").value="";
  document.getElementById("expandedKeywords").value="";
  document.getElementById("urlFooter").innerText="";
  generatedURL="";
}

/* ========= HISTORY ========= */

function saveHistory(){
  if(!generatedURL) return;
  const history=JSON.parse(localStorage.getItem(LS_HISTORY)||"[]");
  history.unshift({
    companies:document.getElementById("companies").value,
    url:generatedURL,
    time:new Date().toLocaleString()
  });
  localStorage.setItem(LS_HISTORY,JSON.stringify(history.slice(0,10)));
  renderHistory();
}

function renderHistory(){
  const history=JSON.parse(localStorage.getItem(LS_HISTORY)||"[]");
  const container=document.getElementById("historyList");
  container.innerHTML="";
  history.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerHTML=`
      <div class="history-meta">${item.time}</div>
      <div>${item.companies}</div>
      <button onclick="loadHistory(${i})">Load</button>
      <button onclick="deleteHistory(${i})">Delete</button>
    `;
    container.appendChild(div);
  });
}

function loadHistory(i){
  const history=JSON.parse(localStorage.getItem(LS_HISTORY)||"[]");
  const item=history[i];
  if(!item) return;
  document.getElementById("companies").value=item.companies;
  generatedURL=item.url;
  document.getElementById("urlFooter").innerText=generatedURL;
}

function deleteHistory(i){
  const history=JSON.parse(localStorage.getItem(LS_HISTORY)||"[]");
  history.splice(i,1);
  localStorage.setItem(LS_HISTORY,JSON.stringify(history));
  renderHistory();
}

function clearHistory(){
  const lang=localStorage.getItem(LS_LANG)||"en";
  if(!confirm(i18n[lang].clearHistory)) return;
  localStorage.removeItem(LS_HISTORY);
  renderHistory();
}

/* INIT */
addKeywordGroup("");
renderHistory();

</script>
</body>
</html>
