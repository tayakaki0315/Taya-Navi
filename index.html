<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taya Navi</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
:root{
  --bg:#0f1117;
  --card:#171a23;
  --text:#eaeef3;
  --border:#2a2f3c;
  --green:#1bb76e;
  --blue:#2f5eff;
  --red:#c0392b;
}
.light{
  --bg:#f4f6fb;
  --card:#ffffff;
  --text:#111;
  --border:#d0d6e2;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:30px;
}
.container{max-width:1000px;margin:auto}
.card{
  background:var(--card);
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}
textarea,select{
  width:100%;
  background:var(--bg);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  margin-top:6px;
}
button{
  padding:6px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  cursor:pointer;
  margin-right:8px;
}
.btn-generate{background:var(--green);color:white;border:none;}
.btn-open{background:var(--blue);color:white;border:none;}
.btn-copy{background:transparent;color:var(--text);}
.btn-clear{background:var(--red);color:white;border:none;}
.group{
  margin-bottom:15px;
  position:relative;
}
.remove-btn{
  position:absolute;
  right:0;
  top:0;
  font-size:12px;
  cursor:pointer;
  opacity:.65;
}
.footer{
  margin-top:30px;
  font-size:11px;
  opacity:.35;
  word-break:break-all;
}
.history-item{
  font-size:12px;
  border:1px solid var(--border);
  padding:8px;
  border-radius:8px;
  margin-bottom:8px;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.controls{
  display:flex;
  gap:10px;
  align-items:center;
}
.toggle{cursor:pointer;opacity:.7;}
hr{margin:18px 0;opacity:.2}
</style>
</head>

<body>
<div class="container">

<div class="topbar">
  <h2 id="ui_title">Taya Navi v3.4</h2>
  <div class="controls">
    <select id="lang">
      <option value="en" selected>English</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="zh">‰∏≠Êñá</option>
    </select>
    <div class="toggle" onclick="toggleTheme()">üåô / ‚òÄ</div>
  </div>
</div>

<div class="card">
  <label><b id="ui_company_label">Company Names</b></label>
  <textarea id="companies"></textarea>

  <label><b id="ui_mode_label">Mode</b></label>
  <select id="mode">
    <option value="PAST" id="ui_mode_past">Former only (exclude current)</option>
    <option value="CURRENT" id="ui_mode_current">Current only</option>
    <option value="BOTH" id="ui_mode_both">Both (Current + Past)</option>
  </select>

  <hr>

  <div id="keywordContainer"></div>
  <button id="ui_add_group" onclick="addKeywordGroup()">+ Add Keyword Group (AND)</button>

  <br><br>

  <button class="btn-generate" onclick="generate()" id="ui_btn_generate">Generate</button>
  <button class="btn-open" onclick="openURL()" id="ui_btn_open">Open</button>
  <button class="btn-copy" onclick="copyURL()" id="ui_btn_copy">Copy</button>
  <button class="btn-clear" onclick="clearAllInputs()" id="ui_btn_clear">Clear All</button>
</div>

<div class="card">
  <h3 id="ui_exp_companies">Expanded Companies</h3>
  <textarea id="expandedCompanies" readonly></textarea>

  <h3 id="ui_exp_keywords">Expanded Keywords</h3>
  <textarea id="expandedKeywords" readonly></textarea>
</div>

<div class="card">
  <h3 id="ui_history_title">Recent Searches</h3>
  <div id="historyList"></div>
  <button class="btn-clear" onclick="clearHistory()" id="ui_clear_history">Clear History</button>
</div>

<div class="footer" id="urlFooter"></div>

</div>

<script>

const SPLIT_REGEX=/[\r\n,Ôºå„ÄÅ„ÄÇ:Ôºö„Éª\/\\;Ôºõ]+/g;
const MAX_GROUPS=4;
const MAX_HISTORY=10;
const LS_KEY="tayaHistory_v34";

let keywordGroups=[];
let generatedURL="";

function uniq(arr){return [...new Set(arr.map(x=>x.trim()).filter(Boolean))];}

function encForKeywords(raw){
  const once = encodeURIComponent(raw)
    .replace(/\(/g,"%28")
    .replace(/\)/g,"%29");
  return once.replace(/%/g,"%25");
}

function encForCompany(raw){
  const once = encodeURIComponent(raw);
  return once.replace(/%/g,"%25");
}

function formatGroup(raw){
  const list=uniq((raw||"").split(SPLIT_REGEX));
  if(!list.length) return "";
  return list.map(k=>{
    if(/[\u4e00-\u9fff]/.test(k)) return `‚Äú${k}‚Äù`;
    return `"${k}"`;
  }).join(" OR ");
}

function buildFilters(names,mode){
  function values(list,type){
    return list.map(n=>`(text%3A${encForCompany(n)}%2CselectionType%3A${type})`).join("%2C");
  }
  if(mode==="PAST")
    return `(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"EXCLUDED")}))`;
  if(mode==="CURRENT")
    return `(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
  return `(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
}

function generate(){
  const companies=document.getElementById("companies").value;
  const mode=document.getElementById("mode").value;
  const names=uniq((companies||"").split(SPLIT_REGEX));
  document.getElementById("expandedCompanies").value=names.join("\n");

  const filters=buildFilters(names,mode);
  const groupsFormatted=keywordGroups.map(id=>formatGroup(document.getElementById(id).value)).filter(Boolean);
  const keywordString=groupsFormatted.map(g=>`(${g})`).join(" AND ");
  document.getElementById("expandedKeywords").value=keywordString;

  const keywordBlock=keywordString?`%2Ckeywords%3A${encForKeywords(keywordString)}`:"";
  const query=`(spellCorrectionEnabled%3Atrue%2CrecentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(${filters})${keywordBlock})`;
  generatedURL=`https://www.linkedin.com/sales/search/people?query=${query}&viewAllFilters=true`;
  document.getElementById("urlFooter").innerText=generatedURL;
  saveHistory();
}

function copyURL(){if(generatedURL)navigator.clipboard.writeText(generatedURL);}
function openURL(){if(generatedURL)window.open(generatedURL,"_blank");}

function addKeywordGroup(value=""){
  if(keywordGroups.length>=MAX_GROUPS)return;
  const id="kw"+Date.now();
  keywordGroups.push(id);
  const div=document.createElement("div");
  div.className="group";
  div.innerHTML=`<label><b>Keyword Group (${keywordGroups.length})</b></label>
  <span class="remove-btn" onclick="removeGroup('${id}')">Remove</span>
  <textarea id="${id}">${value}</textarea>`;
  document.getElementById("keywordContainer").appendChild(div);
}

function removeGroup(id){
  keywordGroups=keywordGroups.filter(x=>x!==id);
  document.getElementById(id).parentElement.remove();
}

function clearAllInputs(){
  const msgs={
    en:"Are you sure you want to clear all inputs?",
    ja:"ÂÖ•ÂäõÂÜÖÂÆπ„Çí„Åô„Åπ„Å¶„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü",
    zh:"Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËæìÂÖ•ÂÜÖÂÆπÂêóÔºü"
  };
  const lang=document.getElementById("lang").value;
  if(!confirm(msgs[lang]||msgs.en))return;

  document.getElementById("companies").value="";
  document.getElementById("mode").value="PAST";
  document.getElementById("keywordContainer").innerHTML="";
  keywordGroups=[];
  addKeywordGroup("");
  document.getElementById("expandedCompanies").value="";
  document.getElementById("expandedKeywords").value="";
  document.getElementById("urlFooter").innerText="";
  generatedURL="";
}

function saveHistory(){
  if(!generatedURL)return;
  const history=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  history.unshift({
    companies:document.getElementById("companies").value,
    mode:document.getElementById("mode").value,
    keywords:keywordGroups.map(id=>document.getElementById(id).value),
    url:generatedURL,
    time:new Date().toLocaleString()
  });
  localStorage.setItem(LS_KEY,JSON.stringify(history.slice(0,MAX_HISTORY)));
  renderHistory();
}

function renderHistory(){
  const history=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  const container=document.getElementById("historyList");
  container.innerHTML="";
  history.forEach((item,index)=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerHTML=`<b>${item.time}</b><br>${item.companies}<br>
    <button onclick="loadHistory(${index})">Load</button>
    <button onclick="deleteHistory(${index})">Delete</button>`;
    container.appendChild(div);
  });
}

function loadHistory(index){
  const history=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  const item=history[index];
  if(!item)return;
  document.getElementById("companies").value=item.companies;
  document.getElementById("mode").value=item.mode;
  document.getElementById("keywordContainer").innerHTML="";
  keywordGroups=[];
  item.keywords.forEach(k=>addKeywordGroup(k));
  generatedURL=item.url;
  document.getElementById("urlFooter").innerText=generatedURL;
}

function deleteHistory(index){
  const history=JSON.parse(localStorage.getItem(LS_KEY)||"[]");
  history.splice(index,1);
  localStorage.setItem(LS_KEY,JSON.stringify(history));
  renderHistory();
}

function clearHistory(){
  const msgs={
    en:"Clear all history?",
    ja:"Â±•Ê≠¥„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü",
    zh:"Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü"
  };
  const lang=document.getElementById("lang").value;
  if(!confirm(msgs[lang]||msgs.en))return;
  localStorage.removeItem(LS_KEY);
  renderHistory();
}

function toggleTheme(){document.body.classList.toggle("light");}

addKeywordGroup("");
renderHistory();

</script>
</body>
</html>
