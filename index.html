<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Taya Navi</title>

  <style>

    :root{

      --bg:#0b0c10; --card:#111319; --card2:#0f1117; --text:#e9ecf1; --muted:#a8b0bd;

      --line:#222635; --accent:#7aa2ff; --good:#7ef0c1; --warn:#ffcc66; --bad:#ff6b6b;

      --shadow:0 10px 30px rgba(0,0,0,.35); --r:16px;

    }

    @media (prefers-color-scheme: light){

      :root{

        --bg:#f6f7fb; --card:#fff; --card2:#fbfbfe; --text:#111827; --muted:#5b6472;

        --line:#e5e7ef; --accent:#2f5eff; --good:#0ea5e9; --warn:#b45309; --bad:#dc2626;

        --shadow:0 12px 26px rgba(17,24,39,.08);

      }

    }

    *{box-sizing:border-box}

    body{

      margin:0; padding:28px;

      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;

      background:var(--bg); color:var(--text); line-height:1.45;

    }

    .wrap{max-width:1120px;margin:0 auto}

    .top{display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap;margin-bottom:16px}

    h1{margin:0 0 6px 0;font-size:20px;letter-spacing:.2px}

    .sub{margin:0;color:var(--muted);font-size:12.5px}

    .grid{display:grid;grid-template-columns:1.25fr .75fr;gap:16px}

    @media(max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:16px;box-shadow:var(--shadow)}

    .card h2{margin:0 0 10px 0;font-size:14px;display:flex;justify-content:space-between;align-items:center;gap:10px}

    label{display:block;margin:0 0 6px 0}

    textarea,input,select{

      width:100%; background:transparent; color:var(--text);

      border:1px solid var(--line); border-radius:12px; padding:10px 12px; outline:none; font-size:13px;

    }

    textarea{min-height:210px;resize:vertical}

    .hint{color:var(--muted);font-size:12px;margin-top:6px}

    .row{display:grid;gap:10px}

    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    @media(max-width:540px){.two{grid-template-columns:1fr}}

    details{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--card2)}

    summary{cursor:pointer;font-size:13px}

    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}

    button{

      border:1px solid var(--line);

      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));

      color:var(--text); border-radius:12px; padding:10px 12px; cursor:pointer; font-size:13px;

    }

    button.primary{border-color:rgba(122,162,255,.35);background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.10))}

    button.ghost{background:transparent}

    button:active{transform:translateY(1px)}

    .status{margin-top:10px;font-size:12px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    .pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);background:var(--card2);

      border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}

    .good{color:var(--good);font-weight:700}

    .warn{color:var(--warn);font-weight:700}

    .bad{color:var(--bad);font-weight:700}

    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

    .out{min-height:190px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px}

  </style>

</head>

<body>

<div class="wrap">

  <div class="top">

    <div>

      <h1>Taya Navi <span class="mono">v2.1</span></h1>

      <p class="sub">

        Paste company names → choose mode → generate a <span class="good">shared URL (no sessionId)</span> for Sales Navigator. <br/>

        <b>Former only</b> automatically adds <span class="mono">CURRENT_COMPANY=EXCLUDED</span> to exclude people currently at those companies.

      </p>

    </div>

  </div>



  <div class="grid">

    <div class="card">

      <h2>

        <span>Input</span>

        <span class="pill"><span class="good">Stable</span> double-encode + length guard + split</span>

      </h2>



      <label><b>Company names</b></label>

      <textarea id="companies" placeholder="Examples (any delimiter works):

Takasago / T. Hasegawa, IFF; ADM

高砂香料工業、長谷川香料

Milliken (Westex)・Glen Raven"></textarea>

      <div class="hint">

        Auto-splits by: comma <span class="mono">,</span> / Chinese comma <span class="mono">，</span> / Japanese <span class="mono">、</span> / colon <span class="mono">:</span> <span class="mono">：</span> / middle dot <span class="mono">・</span> / slash <span class="mono">/</span> <span class="mono">\</span> / semicolon <span class="mono">;</span> <span class="mono">；</span> / newline.

      </div>



      <div style="height:12px;"></div>



      <div class="two">

        <div class="row">

          <label><b>Mode</b></label>

          <select id="mode">

            <option value="PAST">Former only (PAST included + CURRENT excluded)</option>

            <option value="CURRENT">Current only</option>

            <option value="BOTH">Both (CURRENT + PAST)</option>

          </select>

        </div>

        <div class="row">

          <label><b>Auto expansion (dictionary)</b></label>

          <select id="dictMode">

            <option value="ON" selected>ON (recommended)</option>

            <option value="OFF">OFF (input only)</option>

          </select>

        </div>

      </div>



      <div style="height:10px;"></div>



      <details>

        <summary><b>Advanced</b> (industry templates, dictionary JSON, splitting)</summary>

        <div style="height:10px;"></div>



        <div class="two">

          <div class="row">

            <label><b>Industry template</b></label>

            <select id="dictTemplate">

              <option value="generic" selected>Generic (minimal)</option>

              <option value="ff">Fragrance & Flavor</option>

              <option value="dc">Data Center</option>

              <option value="chem">Chemicals</option>

              <option value="energy">Energy</option>

            </select>

            <div class="hint">Selecting a template overwrites the dictionary JSON below.</div>

          </div>



          <div class="row">

            <label><b>Auto split URL</b></label>

            <select id="splitMode">

              <option value="AUTO" selected>AUTO (split only when too long)</option>

              <option value="OFF">OFF (never split)</option>

              <option value="ALWAYS">ALWAYS (always split)</option>

            </select>

            <div class="hint">Both-mode can get long quickly; AUTO is recommended.</div>

          </div>

        </div>



        <div style="height:10px;"></div>



        <div class="row">

          <label><b>Max companies per URL (when splitting)</b></label>

          <input id="chunkSize" value="22" />

          <div class="hint">Double-encoding increases length; default is conservative.</div>

        </div>



        <div style="height:10px;"></div>



        <label><b>Dictionary (JSON)</b> — input → aliases to add automatically</label>

        <textarea id="dictJson" class="out" style="min-height:190px;"></textarea>

        <div class="hint">

          Format: {"Company A":["Alias 1","Alias 2"]}. Edit here to extend offline auto-complete.

        </div>

      </details>



      <div class="btns">

        <button class="primary" id="buildBtn">Generate URL</button>

        <button id="copyTeamBtn">Copy shared URL</button>

        <button id="openTeamBtn" class="ghost">Open shared URL</button>

      </div>



      <div id="status" class="status"></div>

    </div>



    <div class="card">

      <h2><span>Output</span><span class="pill">Shared URL only</span></h2>



      <label><b>Shared URL (no sessionId)</b></label>

      <textarea id="output" class="out" readonly></textarea>

      <div class="hint">

        If AUTO split triggers, multiple URLs will be listed. Open them one by one.

      </div>



      <div style="height:12px;"></div>



      <label><b>Expanded keywords (what actually gets sent)</b></label>

      <textarea id="expanded" class="out" readonly></textarea>

      <div class="hint">

        If expansions create noise, switch dictionary OFF or remove entries from the JSON.

      </div>

    </div>

  </div>



  <p class="sub" style="margin-top:14px;">

    If updates don’t show up, add <span class="mono">?v=123</span> to the URL to bypass cache.

  </p>

</div>



<script>

  // ========= Encoding =========

  // Company text: encodeURIComponent + explicit ( ) , encoding + double-encode (% -> %25)

  function encTextForCompany(name) {

    const once = encodeURIComponent(name)

      .replace(/\(/g, "%28")

      .replace(/\)/g, "%29")

      .replace(/,/g, "%2C");

    return once.replace(/%/g, "%25");

  }



  // ========= Global legal suffix removal =========

  // JP: 株式会社 有限会社 合同会社 合資会社 合名会社 （株） （有） ㈱ ㈲

  // Global: Co., Ltd / Ltd / Limited / Inc / Corporation / LLC / PLC / AG / GmbH / S.A. / S.p.A. / B.V. / N.V. / Pty Ltd / K.K.

  // Only remove if at the end (or surrounded by spaces/punctuation).

  const JP_SUFFIXES = [

    "株式会社","有限会社","合同会社","合資会社","合名会社",

    "（株）","（有）","(株)","(有)","㈱","㈲"

  ];



  const EN_SUFFIX_PATTERNS = [

    /,\s*co\.\s*ltd\.?$/i,

    /\bco\.\s*ltd\.?$/i,

    /\bco,\s*ltd\.?$/i,

    /\bco\s*ltd\.?$/i,

    /\bltd\.?$/i,

    /\blimited$/i,

    /\binc\.?$/i,

    /\bincorporated$/i,

    /\bcorp\.?$/i,

    /\bcorporation$/i,

    /\bllc\.?$/i,

    /\bl\.l\.c\.?$/i,

    /\bplc\.?$/i,

    /\bag$/i,

    /\bgmbh$/i,

    /\bs\.a\.?$/i,

    /\bs\.p\.a\.?$/i,

    /\bb\.v\.?$/i,

    /\bn\.v\.?$/i,

    /\bpty\.?\s*ltd\.?$/i,

    /\bk\.k\.?$/i,

    /\bkk$/i

  ];



  // Optional: remove trailing "Holdings" / "Group" (ONLY when it is the last token)

  const EN_TRAILING_WORDS = [/[\s,.-]+holdings$/i, /[\s,.-]+group$/i];



  function stripLegalSuffixes(name) {

    let s = (name || "").trim();

    if (!s) return s;



    // JP exact suffix tokens (end-only)

    for (const suf of JP_SUFFIXES) {

      if (s.endsWith(suf)) {

        s = s.slice(0, s.length - suf.length).trim();

      }

    }



    // Remove extra punctuation at the end before EN checks

    s = s.replace(/[，、。．\.\s]+$/g, "").trim();



    // EN patterns

    for (const re of EN_SUFFIX_PATTERNS) {

      s = s.replace(new RegExp(re.source, re.flags), "").trim();

      s = s.replace(/[,\.\s]+$/g, "").trim();

    }



    // Trailing "Holdings"/"Group" (careful)

    for (const re of EN_TRAILING_WORDS) {

      s = s.replace(re, "").trim();

      s = s.replace(/[,\.\s]+$/g, "").trim();

    }



    return s.trim();

  }



  // ========= Parsing: multi-delimiter split =========

  // Split by: newline, comma, Chinese comma, Japanese comma, colon variants, middle dot, slash/backslash, semicolon variants

  const SPLIT_RE = /[\r\n,，、:：・\/\\;；]+/g;



  function parseCompanies(text) {

    return (text || "")

      .split(SPLIT_RE)

      .map(x => x.trim())

      .filter(Boolean);

  }



  function uniq(arr) {

    const seen = new Set();

    const out = [];

    for (const x of arr) {

      const t = (x || "").trim();

      if (!t) continue;

      const key = t.toLowerCase();

      if (seen.has(key)) continue;

      seen.add(key);

      out.push(t);

    }

    return out;

  }



  function safeInt(v, fallback) {

    const n = parseInt(String(v || "").trim(), 10);

    return Number.isFinite(n) && n > 0 ? n : fallback;

  }



  function chunkArray(arr, chunkSize) {

    const out = [];

    for (let i = 0; i < arr.length; i += chunkSize) out.push(arr.slice(i, i + chunkSize));

    return out;

  }



  // ========= Industry templates (dictionary) =========

  // You can expand these over time; they’re offline mappings.

  const DICT_TEMPLATES = {

    generic: {

      "Archer-Daniels-Midland": ["ADM"],

      "International Flavors & Fragrances": ["IFF"]

    },

    ff: {

      "高砂香料工業": ["TAKASAGO INTERNATIONAL CORPORATION", "TAKASAGO INTERNATIONAL"],

      "長谷川香料": ["T. HASEGAWA CO., LTD.", "T. HASEGAWA"],

      "小川香料": ["Ogawa & Co., Ltd.", "Ogawa &"],

      "塩野香料": ["SHIONO KORYO KAISHA, LTD", "SHIONO KORYO KAISHA"],

      "Archer-Daniels-Midland": ["ADM"],

      "International Flavors & Fragrances": ["IFF"],

      "DSM Firmenich": ["Firmenich", "DSM-Firmenich"]

    },

    dc: {

      "NTTコミュニケーションズ": ["NTT Communications", "NTT Com", "NTT Communications Corporation"],

      "さくらインターネット": ["Sakura Internet", "SAKURA internet"],

      "KDDI": ["KDDI Corporation"],

      "ソフトバンク": ["SoftBank", "SoftBank Corp."],

      "エクイニクス": ["Equinix"],

      "AirTrunk": ["Air Trunk"],

      "富士通": ["Fujitsu", "Fujitsu Limited"],

      "NEC": ["NEC Corporation"],

      "TIS": ["TIS Inc.", "TIS"],

      "日立製作所": ["Hitachi", "Hitachi, Ltd."]

    },

    chem: {

      "BASF": ["BASF SE"],

      "Dow": ["Dow Inc.", "The Dow Chemical Company"],

      "Evonik": ["Evonik Industries"],

      "三菱ケミカル": ["Mitsubishi Chemical", "Mitsubishi Chemical Group"],

      "住友化学": ["Sumitomo Chemical"],

      "旭化成": ["Asahi Kasei"]

    },

    energy: {

      "NextEra": ["NextEra Energy"],

      "NRG": ["NRG Energy"],

      "Talen": ["Talen Energy"],

      "AEP": ["American Electric Power"],

      "Constellation": ["Constellation Energy"],

      "PJM": ["PJM Interconnection"],

      "FERC": ["Federal Energy Regulatory Commission"]

    }

  };



  function getDictFromTextarea() {

    const raw = document.getElementById("dictJson").value.trim();

    if (!raw) return {};

    try {

      const obj = JSON.parse(raw);

      if (!obj || typeof obj !== "object") return {};

      return obj;

    } catch (e) {

      return null; // invalid JSON

    }

  }



  function expandNames(inputNames, dictOn, dictObj) {

    let out = [];

    for (const raw of inputNames) {

      const n = raw.trim();

      if (!n) continue;



      // Original

      out.push(n);



      // Legal suffix stripped (JP + global)

      const stripped = stripLegalSuffixes(n);

      if (stripped && stripped !== n) out.push(stripped);



      // Also attempt removing only 株式会社 quickly (legacy compatibility)

      const jpQuick = n.replace(/株式会社/g, "").trim();

      if (jpQuick && jpQuick !== n) out.push(jpQuick);



      // Dictionary expansions

      if (dictOn && dictObj) {

        const adds = []

          .concat(dictObj[n] || [])

          .concat(dictObj[stripped] || [])

          .concat(dictObj[jpQuick] || []);

        out.push(...adds);

      }

    }



    // Second pass: strip suffixes on added items too

    const second = [];

    for (const x of out) {

      second.push(x);

      const s2 = stripLegalSuffixes(x);

      if (s2 && s2 !== x) second.push(s2);

    }



    return uniq(second);

  }



  // ========= Build query =========

  function buildValuesEncoded(names, selectionType) {

    return names

      .map(n => `(text%3A${encTextForCompany(n)}%2CselectionType%3A${selectionType})`)

      .join("%2C");

  }



  function buildQueryEncoded(mode, names) {

    const valuesIncluded = buildValuesEncoded(names, "INCLUDED");

    const valuesExcluded = buildValuesEncoded(names, "EXCLUDED");



    if (mode === "PAST") {

      // former only: PAST included + CURRENT excluded

      return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +

        `(type%3APAST_COMPANY%2Cvalues%3AList(${valuesIncluded}))%2C` +

        `(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesExcluded}))` +

      `))`;

    }

    if (mode === "CURRENT") {

      return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +

        `(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesIncluded}))` +

      `))`;

    }

    // BOTH: PAST included + CURRENT included

    return `(recentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(` +

      `(type%3APAST_COMPANY%2Cvalues%3AList(${valuesIncluded}))%2C` +

      `(type%3ACURRENT_COMPANY%2Cvalues%3AList(${valuesIncluded}))` +

    `))`;

  }



  function buildSNUrl({ mode, names }) {

    const query = buildQueryEncoded(mode, names);

    return `https://www.linkedin.com/sales/search/people?query=${query}&viewAllFilters=true`;

  }



  // ========= UI logic =========

  const $companies = document.getElementById("companies");

  const $mode = document.getElementById("mode");

  const $dictMode = document.getElementById("dictMode");

  const $dictTemplate = document.getElementById("dictTemplate");

  const $dictJson = document.getElementById("dictJson");

  const $splitMode = document.getElementById("splitMode");

  const $chunkSize = document.getElementById("chunkSize");

  const $output = document.getElementById("output");

  const $expanded = document.getElementById("expanded");

  const $status = document.getElementById("status");



  let lastTeamUrls = [];



  function setStatus(text, level) {

    const cls = level === "good" ? "good" : (level === "warn" ? "warn" : "bad");

    $status.innerHTML = `<span class="${cls}">${text}</span>`;

  }



  function applyTemplate() {

    const key = $dictTemplate.value;

    const obj = DICT_TEMPLATES[key] || DICT_TEMPLATES.generic;

    $dictJson.value = JSON.stringify(obj, null, 2);

  }



  async function copyText(text) {

    try { await navigator.clipboard.writeText(text); return true; }

    catch { return false; }

  }



  function openUrl(url) {

    window.open(url, "_blank", "noopener,noreferrer");

  }



  function build() {

    const input = parseCompanies($companies.value);

    const mode = $mode.value;

    const dictOn = ($dictMode.value === "ON");



    const dictObj = getDictFromTextarea();

    if (dictOn && dictObj === null) {

      setStatus("Dictionary JSON is invalid. Fix JSON or turn dictionary OFF.", "bad");

      return;

    }



    const expanded = expandNames(input, dictOn, dictObj || {});

    $expanded.value = expanded.join("\n");



    // URL length policy (double encoding => stricter)

    const hardLimit = 7600;

    const warnLimit = 6200;



    const splitMode = $splitMode.value;

    const chunkSize = safeInt($chunkSize.value, 22);



    function buildOne(names) {

      return buildSNUrl({ mode, names });

    }



    // build once first

    let urls = [buildOne(expanded)];

    const len = urls[0].length;



    const mustSplit = (splitMode === "ALWAYS") || (splitMode === "AUTO" && len > hardLimit);

    const shouldWarn = (len > warnLimit);



    if (mustSplit) {

      const chunks = chunkArray(expanded, chunkSize);

      urls = chunks.map(c => buildOne(c));

    }



    lastTeamUrls = urls;



    // output

    const lines = [];

    if (lastTeamUrls.length === 1) {

      lines.push("[Shared URL (no sessionId)]");

      lines.push(lastTeamUrls[0]);

    } else {

      lines.push(`[Shared URL (no sessionId)] Split into ${lastTeamUrls.length} URLs`);

      lastTeamUrls.forEach((u, i) => lines.push(`(${i+1}) ${u}`));

    }

    $output.value = lines.join("\n");



    // status

    if (lastTeamUrls.length > 1) {

      setStatus(`Done: ${expanded.length} keywords. URL too long → split into ${lastTeamUrls.length}. (Open one by one)`, "good");

      return;

    }

    if (shouldWarn) {

      setStatus(`Done: ${expanded.length} keywords. URL length ${len} (long). Consider AUTO split for BOTH mode.`, "warn");

    } else {

      setStatus(`Done: ${expanded.length} keywords. URL length ${len}.`, "good");

    }

  }



  document.getElementById("buildBtn").addEventListener("click", build);



  document.getElementById("copyTeamBtn").addEventListener("click", async () => {

    if (!lastTeamUrls.length) build();

    const ok = await copyText(lastTeamUrls.join("\n"));

    setStatus(ok ? "Copied shared URL(s)." : "Copy failed. Please copy manually.", ok ? "good" : "bad");

  });



  document.getElementById("openTeamBtn").addEventListener("click", () => {

    if (!lastTeamUrls.length) build();

    openUrl(lastTeamUrls[0]);

  });



  $dictTemplate.addEventListener("change", () => {

    applyTemplate();

    setStatus("Applied industry template. You can edit the JSON further.", "good");

  });



  // init

  applyTemplate();

  build();

</script>

</body>

</html>
