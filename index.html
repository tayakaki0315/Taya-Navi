<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taya Navi</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
:root{
  --bg:#0f1117;
  --card:#171a23;
  --text:#eaeef3;
  --border:#2a2f3c;
  --primary:#2f5eff;
}
.light{
  --bg:#f4f6fb;
  --card:#ffffff;
  --text:#111;
  --border:#d0d6e2;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:30px;
  transition:.25s;
}
.container{max-width:1000px;margin:auto}
.card{
  background:var(--card);
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}
textarea,input,select{
  width:100%;
  background:var(--bg);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  margin-top:6px;
  font-size:14px;
}
button{
  padding:6px 10px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  cursor:pointer;
}
.primary{
  background:var(--primary);
  border:none;
  color:white;
}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.group{margin-bottom:15px;}
.footer{
  margin-top:40px;
  font-size:12px;
  opacity:.35;
  word-break:break-all;
}
.history-item{
  font-size:12px;
  margin-bottom:6px;
  padding:6px;
  border:1px solid var(--border);
  border-radius:6px;
}
.history-buttons{
  margin-top:4px;
}
.toggle{cursor:pointer;opacity:.6;}
</style>
</head>

<body>
<div class="container">

<div class="topbar">
<h2>Taya Navi v3.1</h2>
<div class="toggle" onclick="toggleTheme()">ðŸŒ™ / â˜€</div>
</div>

<div class="card">
<label><b>Company Names</b></label>
<textarea id="companies"></textarea>

<label><b>Mode</b></label>
<select id="mode">
<option value="PAST">Former only (exclude current)</option>
<option value="CURRENT">Current only</option>
<option value="BOTH">Both (Current + Past)</option>
</select>

<hr style="margin:20px 0;opacity:.2">

<div id="keywordContainer"></div>
<button onclick="addKeywordGroup()">+ Add Keyword Group (AND)</button>

<br><br>

<button class="primary" onclick="copyURL()">Copy URL</button>
<button onclick="openURL()">Open URL</button>

</div>

<div class="card">
<h3>Recent Searches</h3>
<div id="historyList"></div>
<button onclick="clearHistory()">Clear All</button>
</div>

<div class="footer" id="urlFooter"></div>

</div>

<script>

const SPLIT_REGEX=/[\r\n,ï¼Œã€:ï¼šãƒ»\/\\;ï¼›]+/g;
const MAX_GROUPS=4;
const MAX_HISTORY=10;

let keywordGroups=[];
let generatedURL="";

function uniq(arr){
  return [...new Set(arr.map(x=>x.trim()).filter(Boolean))];
}

function encodeCompany(name){
  return encodeURIComponent(name).replace(/%/g,"%25");
}

function encodeKeywords(str){
  return encodeURIComponent(str).replace(/%/g,"%25");
}

function formatGroup(raw){
  let list=uniq(raw.split(SPLIT_REGEX));
  if(!list.length) return "";
  let formatted=list.map(k=>{
    if(/[\u4e00-\u9fff]/.test(k)){
      return "â€œ"+k+"â€";
    }else{
      return "\""+k+"\"";
    }
  });
  return formatted.join(" OR ");
}

function buildURL(){
  let companies=document.getElementById("companies").value;
  let mode=document.getElementById("mode").value;
  let names=uniq(companies.split(SPLIT_REGEX));

  function values(list,type){
    return list.map(n=>`(text%3A${encodeCompany(n)}%2CselectionType%3A${type})`).join("%2C");
  }

  let filters="";
  if(mode==="PAST"){
    filters=`(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"EXCLUDED")}))`;
  }
  else if(mode==="CURRENT"){
    filters=`(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
  }
  else{
    filters=`(type%3APAST_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))%2C(type%3ACURRENT_COMPANY%2Cvalues%3AList(${values(names,"INCLUDED")}))`;
  }

  let keywordString="";
  keywordGroups.forEach(group=>{
    let val=document.getElementById(group).value;
    let formatted=formatGroup(val);
    if(formatted){
      if(keywordString===""){
        keywordString=formatted;
      }else{
        keywordString=`(${keywordString}) AND (${formatted})`;
      }
    }
  });

  let keywordBlock="";
  if(keywordString){
    keywordBlock=`%2Ckeywords%3A${encodeKeywords(keywordString)}`;
  }

  let query=`(spellCorrectionEnabled%3Atrue%2CrecentSearchParam%3A(doLogHistory%3Atrue)%2Cfilters%3AList(${filters})${keywordBlock})`;

  generatedURL=`https://www.linkedin.com/sales/search/people?query=${query}&viewAllFilters=true`;

  document.getElementById("urlFooter").innerText=generatedURL;

  saveHistory();
}

function copyURL(){
  if(generatedURL)
    navigator.clipboard.writeText(generatedURL);
}

function openURL(){
  if(generatedURL)
    window.open(generatedURL,"_blank");
}

function toggleTheme(){
  document.body.classList.toggle("light");
}

function addKeywordGroup(){
  if(keywordGroups.length>=MAX_GROUPS) return;
  let id="kw"+Date.now();
  keywordGroups.push(id);

  let div=document.createElement("div");
  div.className="group";
  div.innerHTML=`<label><b>Keyword Group (${keywordGroups.length})</b></label>
  <textarea id="${id}"></textarea>`;
  document.getElementById("keywordContainer").appendChild(div);
  document.getElementById(id).addEventListener("input",buildURL);
}

function saveHistory(){
  if(!generatedURL) return;
  let history=JSON.parse(localStorage.getItem("tayaHistory")||"[]");

  history.unshift({
    companies:document.getElementById("companies").value,
    mode:document.getElementById("mode").value,
    keywords:keywordGroups.map(id=>document.getElementById(id).value),
    url:generatedURL,
    time:new Date().toLocaleString()
  });

  history=history.slice(0,MAX_HISTORY);
  localStorage.setItem("tayaHistory",JSON.stringify(history));
  renderHistory();
}

function renderHistory(){
  let history=JSON.parse(localStorage.getItem("tayaHistory")||"[]");
  let container=document.getElementById("historyList");
  container.innerHTML="";

  history.forEach((item,index)=>{
    let div=document.createElement("div");
    div.className="history-item";
    div.innerHTML=`<b>${item.time}</b><br>${item.companies}<div class="history-buttons">
    <button onclick="loadHistory(${index})">Load</button>
    <button onclick="deleteHistory(${index})">Delete</button>
    </div>`;
    container.appendChild(div);
  });
}

function loadHistory(index){
  let history=JSON.parse(localStorage.getItem("tayaHistory")||"[]");
  let item=history[index];
  document.getElementById("companies").value=item.companies;
  document.getElementById("mode").value=item.mode;

  document.getElementById("keywordContainer").innerHTML="";
  keywordGroups=[];
  item.keywords.forEach(k=>{
    addKeywordGroup();
    document.getElementById(keywordGroups[keywordGroups.length-1]).value=k;
  });

  buildURL();
}

function deleteHistory(index){
  let history=JSON.parse(localStorage.getItem("tayaHistory")||"[]");
  history.splice(index,1);
  localStorage.setItem("tayaHistory",JSON.stringify(history));
  renderHistory();
}

function clearHistory(){
  localStorage.removeItem("tayaHistory");
  renderHistory();
}

document.getElementById("companies").addEventListener("input",buildURL);
document.getElementById("mode").addEventListener("change",buildURL);

addKeywordGroup();
renderHistory();

</script>
</body>
</html>
